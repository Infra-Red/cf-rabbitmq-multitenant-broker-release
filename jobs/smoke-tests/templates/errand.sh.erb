#!/bin/bash

set -e

. /var/vcap/jobs/smoke-tests/bin/change-permissions
. /var/vcap/jobs/smoke-tests/bin/permissions-test

export GOPATH=/var/vcap/packages/cf-rabbitmq-smoke-tests
export GOROOT=/var/vcap/packages/golang-1.8
export PATH=/var/vcap/packages/cf-cli/bin:$GOPATH/bin:$GOROOT/bin:$PATH

export REPO_NAME=github.com/pivotal-cf/cf-rabbitmq-smoke-tests
export REPO_DIR=${GOPATH}/src/${REPO_NAME}

export CF_HOME="/tmp/cf_home"
mkdir -p "${CF_HOME}"

export CONFIG_PATH=/var/vcap/jobs/smoke-tests/config.json
export CGO_ENABLED=0

pushd ${REPO_DIR}
  go install -v github.com/onsi/ginkgo/ginkgo
  echo "Running the lifecycle tests"
  ./bin/test_lifecycle
popd
